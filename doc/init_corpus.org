#+TITLE: Niconico大百科データセットを解析する
* Overview
  1. 圧縮ファイルをダウンロードする
  2. 解凍して配置する
  3. すべての記事ファイルについて前処理を施す
  4. データベースと組み合わせる + 前処理を施す
  5. 圧縮して保存する
* 圧縮ファイルをダウンロードする
  IDR の Niconico大百科データセット について利用申請をし、ダウンロードしてください。
* 解凍して配置する
  任意のディレクトリ下について、次のように解凍して配置してください。
  
#+begin_example
.
└── nico-dict
    └── zips
        ├── download.txt
        ├── head
        │   ├── head2008.csv
        │   ├── ...
        │   └── head2014.csv
        ├── head.zip
        ├── res
        │   ├── res2008.csv
        │   ├── ...
        │   └── res2014.csv
        ├── res.zip
        ├── rev2008.zip
        ├── rev2009
        │   ├── rev200901.csv
        │   ├── rev200902.csv
        │   ├── rev200903.csv
        │   ├── ...
        │   └── rev200912.csv
        ├── rev2009.zip
        ├──...
        ├── rev2013.zip
        ├── rev2014
        │   ├── rev201401.csv
        │   └── rev201402.csv
        └── rev2014.zip
#+end_example
* すべての記事ファイルについて前処理を施す
  次の sh を各 ~rev20*~ フォルダ について実行してください。
** 前処理を施す理由
   https://www.tools.ietf.org/html/rfc4180#section-2 にあるように、二重引用符（”)は文中で用いられる際には重ねて書かれることが一般的です。
   しかし、このデータセットでは二重引用符をエスケープしています。つまり
   
   #+begin_example
   "<a href=""https://www.hogehoge.com/a.png"">"
   #+end_example

   とすべき部分を、
      #+begin_example
   "<a href=\"https://www.hogehoge.com/a.png\">"
   #+end_example
   
   としています。

   このため通常の（形式を踏襲している）解析ツールでこのデータを解析することが難しくなっています。
   先述のスクリプトはこれを解決するためのもので、一行目で *\\"* を *""* へ置換して、二行目で *\\""* を *\\"* としています。
   
   二行目については一行目で *\\\\"* というケースを巻き込んで変換してしまうものを修正するために必須のスクリプトとなっています。
